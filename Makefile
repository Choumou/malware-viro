CC=gcc
CFLAGS+=-Wall -Werror -Wextra -pedantic -Iinclude/ -g 
LDFLAGS+=-static -L/lib/x86_64-linux-gnu/libc.so.6

BUILD_DIR=build

TARGET=$(BUILD_DIR)/malware

.PHONY: all clean

OBJECTS=main.o \
		network.o \
		capture.o \
		b64/encode.o \
		b64/decode.o \
		b64/buffer.o \
		propagation.o

all: $(TARGET)

$(TARGET): $(addprefix $(BUILD_DIR)/, $(OBJECTS))
	$(CC) $^ -o $(TARGET) $(LDFLAGS)

$(BUILD_DIR)/%.o: %.c
	mkdir -p $(shell dirname $@)
	$(CC) $(CFLAGS) -c $< -o $@

clean:
	$(RM) -rf $(BUILD_DIR)
